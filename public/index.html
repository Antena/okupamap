<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Okupamap</title>

    <link rel="stylesheet" href="/assets/css/jquery-ui.css" />
    <link rel="stylesheet" href="/assets/css/style.css"/>

    <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script src="/assets/js/jquery-1.8.2.js"></script>
    <script src="/assets/js/jquery-ui.js"></script>

    <script>

        var ftId = '10KmKBbWAifWCsvTZ2HaYMOwGqi7dNgN-HhKkS-k';
        var ftLocationColumn = 'Lugar';

        function initialize() {
            // Map
            var mapCenter = new google.maps.LatLng(-34.773204,-58.348633);
            var mapOptions = {
                zoom: 9,
                center: mapCenter,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            }
            var map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);

            // Fusion Tables layer
            var layer = new google.maps.FusionTablesLayer({
                query: {
                    select: ftLocationColumn,
                    from: ftId
                },
                map: map,
                styles: [{
                    where: "tipo = 'TOMA'",
                    markerOptions: {
                        iconName: "large_red"
                    }
                },{
                    where: "tipo = 'ACCION'",
                    markerOptions: {
                        iconName: "large_green",
                        opacity: 0
                    }
                }
                ]
            });

            // Custom InfoWindow
            google.maps.event.addListener(layer, 'click', function(e) {
                e.infoWindowHtml = '<div class="infoWindow">';
                var date = new Date(e.row['Fecha'].value);
                var dateString = date.getDate() + '/' + (date.getMonth() + 1) + '/' + date.getFullYear();
                e.infoWindowHtml += '<div style="height: 20px;"><img src="assets/images/calendar_icon.png" alt="Fecha" style="float: left; margin-top: 2px;"><span class="text">' + dateString  + '</span></div>';
                e.infoWindowHtml += '<a href="' + e.row['Link'].value + '" target="_blank"><h2>' + e.row['Título'].value + '</h2></a>';
                e.infoWindowHtml += '<div style="height: 30px;"><img src="assets/images/location_icon.png" alt="Lugar" style="float: left;"><span class="text">' + e.row['Lugar'].value + '</span></div>';
                e.infoWindowHtml += '<div style="height: 40px;"><img src="assets/images/link_icon.png" alt="Fecha" style="float: left;"><a href="' + e.row['Link'].value + '" target="_blank"><span class="text">' + e.row['Link'].value + '</span></a></div>';
                e.infoWindowHtml += '</div>';
            });

            // Filter checkboxes
            $("#controls input")
                    .click(function() {
                        // get selected types
                        var inArray = [];
                        $("#controls input:checked").each(function(index, elem) {
                                    inArray.push($(elem).attr("data-type"));
                                }
                        );
                        var ins = inArray.length == 0 ? "'FRUTA'" : inArray.join(", ");
                        var whereClause = "tipo IN (" + ins + ")";

                        // update map
                        layer.setOptions({
                            query: {
                                select: ftLocationColumn,
                                from: ftId,
                                where: whereClause
                            }
                        })
                    })
                    .change(function() {
                        var checked = $(this).attr("checked") == undefined ? false : true;
                        var icon = $(this).closest(".control").find(".icon");
                        if (checked) {
                            icon.removeClass("disabled");
                        } else {
                            icon.addClass("disabled");
                        }
                    });
        }
    </script>
</head>
<body onload="initialize()">
<div id="controls">
    <label>Filtro:</label>
    <div class="control">
        <img src="assets/images/large_red.png" class="icon" alt="Tomas y ocupaciones"> <span class="label">Tomas y ocupaciones</span>
        <input type="checkbox" id="toma" checked data-type="'TOMA'" />
        <p class="description">Noticias relacionadas a la toma u ocupación de terrenos y/o viviendas</p>
    </div>

    <div class="control" style="margin-right: 0px">
        <img src="assets/images/large_green.png" class="icon" alt="Acción Urbana"> <span class="label">Acción Urbana</span>
        <input type="checkbox" id="action" checked data-type="'ACCION'" />
        <p class="description">Noticias relacionadas a acciones urbanas llevadas a cabo en alguna ciudad del país.</p>
    </div>
</div>
<div id="map_canvas"></div>
</body>
</html>