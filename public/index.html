<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Okupamap</title>
    <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.0/themes/base/jquery-ui.css" />
    <script src="http://code.jquery.com/jquery-1.8.2.js"></script>
    <script src="http://code.jquery.com/ui/1.9.0/jquery-ui.js"></script>
    <link rel="stylesheet" href="/assets/css/style.css"/>
    <script>

        var ftId = '10KmKBbWAifWCsvTZ2HaYMOwGqi7dNgN-HhKkS-k';
        var ftLocationColumn = 'Lugar';

        function initialize() {
            // Map
            var mapCenter = new google.maps.LatLng(-34.773204,-58.348633);
            var mapOptions = {
                zoom: 9,
                center: mapCenter,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            }
            var map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);

            // TOMAS: Fusion Tables layer

            var layer = new google.maps.FusionTablesLayer({
                query: {
                    select: ftLocationColumn,
                    from: ftId
                },
                map: map,
                styles: [{
                    where: "tipo = 'TOMA'",
                    markerOptions: {
                        iconName: "large_red"
                    }
                },{
                    where: "tipo = 'ACCION'",
                    markerOptions: {
                        iconName: "large_green",
                        opacity: 0
                    }
                }
                ]
            });

            $("#controls input").click(function() {
                // get selected types
                var inArray = [];
                $("#controls input:checked").each(function(index, elem) {
                            inArray.push($(elem).attr("data-type"));
                        }
                );
                var ins = inArray.length == 0 ? "'FRUTA'" : inArray.join(", ");
                var whereClause = "tipo IN (" + ins + ")";

                // update map
                layer.setOptions({
                    query: {
                        select: ftLocationColumn,
                        from: ftId,
                        where: whereClause
                    }
                })
            })

            $("#controls input").change(function() {
                var checked = $(this).attr("checked") == undefined ? false : true;
                var icon = $(this).closest(".control").find(".icon");
                if (checked) {
                    icon.removeClass("disabled");
                } else {
                    icon.addClass("disabled");
                }
            });
        }
    </script>
</head>
<body onload="initialize()">
<div id="controls">
    <label>Filtro:</label>
    <div class="control">
        <img src="assets/images/large_red.png" class="icon" alt="Tomas y ocupaciones"> <span class="label">Tomas y ocupaciones</span>
        <input type="checkbox" id="toma" checked data-type="'TOMA'" />
        <p class="description">Noticias relacionadas a la toma u ocupación de terrenos y/o viviendas</p>
    </div>

    <div class="control" style="margin-right: 0px">
        <img src="assets/images/large_green.png" class="icon" alt="Acción Urbana"> <span class="label">Acción Urbana</span>
        <input type="checkbox" id="action" checked data-type="'ACCION'" />
        <p class="description">Noticias relacionadas a acciones urbanas llevadas a cabo en alguna ciudad del país.</p>
    </div>
</div>
<div id="map_canvas"></div>
</body>
</html>